(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[142],{6538:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/jobs",function(){return t(646)}])},7435:function(e,s,t){"use strict";t.d(s,{Z:function(){return l}});var a=t(5893);function l(e){let{kind:s="info",message:t,onClose:l}=e,n="success"===s?"green":"warning"===s?"yellow":"error"===s?"red":"blue";return(0,a.jsxs)("div",{className:"rounded-md border px-3 py-2 bg-".concat(n,"-50 border-").concat(n,"-200 text-").concat(n,"-800 flex items-start justify-between gap-2"),children:[(0,a.jsx)("div",{children:t}),l&&(0,a.jsx)("button",{className:"text-".concat(n,"-800"),onClick:l,children:"\xd7"})]})}},646:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return r}});var a=t(5893),l=t(1758),n=t(4985),d=t(5451),i=t(7435),c=t(7294);function r(){let[e,s]=(0,c.useState)(""),[t,r]=(0,c.useState)(1),{data:o,error:u,isLoading:h,mutate:x}=(0,l.ZP)(["/v1/jobs",t,e],e=>{let[,s,t]=e;return d.v1.listJobsV1JobsGet({page:s,status:t})}),[m,b]=(0,c.useState)(Date.now()/1e3);(0,c.useEffect)(()=>{let e=setInterval(()=>b(Date.now()/1e3),1e3);return()=>clearInterval(e)},[]);let[j,p]=(0,c.useState)(null),[N,g]=(0,c.useState)({}),[v,y]=(0,c.useState)({});return(0,a.jsxs)("div",{children:[(0,a.jsx)(n.Z,{}),(0,a.jsxs)("main",{className:"container py-6",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-3",children:(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Jobs"})}),(0,a.jsxs)("div",{className:"card p-4 mb-4 flex items-center gap-2 flex-wrap",children:[(0,a.jsx)("label",{className:"text-gray-700",children:"Status: "}),(0,a.jsxs)("select",{className:"input",value:e,onChange:e=>s(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"All"}),(0,a.jsx)("option",{value:"queued",children:"Queued"}),(0,a.jsx)("option",{value:"in_progress",children:"In Progress"}),(0,a.jsx)("option",{value:"done",children:"Done"}),(0,a.jsx)("option",{value:"failed",children:"Failed"}),(0,a.jsx)("option",{value:"dead",children:"Dead"})]}),(0,a.jsx)("button",{className:"btn",onClick:()=>x(),children:"Filter"}),(0,a.jsx)("button",{className:"btn",onClick:function(){s(""),r(1),x()},children:"Clear"}),(0,a.jsx)("button",{className:"btn",onClick:()=>{s("failed,dead"),r(1),x()},children:"Failed/Dead"}),(0,a.jsx)("div",{className:"grow"}),(0,a.jsx)("button",{className:"btn",onClick:async()=>{try{await d.v1.retryAllJobsV1JobsRetryAllPost({requestBody:{status:["failed","dead"]}}),p({kind:"success",message:"Requeued all failed/dead jobs"}),x()}catch(e){p({kind:"error",message:e.message||String(e)})}},children:"Retry All Failed/Dead"})]}),j&&(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsx)(i.Z,{kind:j.kind,message:j.message,onClose:()=>p(null)})}),h&&(0,a.jsx)("p",{className:"text-gray-600",children:"Loading..."}),u&&(0,a.jsx)(i.Z,{kind:"error",message:String(u)}),o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"card p-0 overflow-hidden",children:(0,a.jsxs)("table",{className:"table",children:[(0,a.jsx)("thead",{className:"bg-gray-100",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"th",scope:"col",children:"ID"}),(0,a.jsx)("th",{className:"th",scope:"col",children:"Type"}),(0,a.jsx)("th",{className:"th",scope:"col",children:"Status"}),(0,a.jsx)("th",{className:"th",scope:"col",children:"Attempts"}),(0,a.jsx)("th",{className:"th",scope:"col",children:"Last Error"}),(0,a.jsx)("th",{className:"th",scope:"col",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:o.items.map(e=>{var s,t,l,n,i,r,o,u;return(0,a.jsxs)(c.Fragment,{children:[(0,a.jsxs)("tr",{className:"odd:bg-white even:bg-gray-50",children:[(0,a.jsx)("td",{className:"td",children:e.id}),(0,a.jsx)("td",{className:"td",children:e.type}),(0,a.jsxs)("td",{className:"td",children:[e.status,"publish"===e.type&&(null===(s=e.details)||void 0===s?void 0:s.deduped)===!0&&(0,a.jsx)("span",{className:"ml-2 px-2 py-0.5 text-xs rounded bg-yellow-100 text-yellow-800",children:"deduped"}),"rss_poll"===e.type&&(null===(t=e.details)||void 0===t?void 0:t.published)!=null&&(0,a.jsxs)("span",{className:"ml-2 px-2 py-0.5 text-xs rounded bg-green-100 text-green-800",children:[e.details.published,"/",e.details.total]})]}),(0,a.jsx)("td",{className:"td",children:e.attempts}),(0,a.jsxs)("td",{className:"td",children:[e.last_error||"","queued"===e.status&&e.available_at&&e.available_at>m&&(0,a.jsxs)("span",{className:"ml-2 text-gray-600",children:["retry in ",Math.max(0,Math.floor(e.available_at-m)),"s"]})]}),(0,a.jsxs)("td",{className:"td flex gap-2",children:[(0,a.jsx)("button",{className:"btn",onClick:async()=>{if(g({...N,[e.id]:!N[e.id]}),!v[e.id])try{let s=await d.v1.getJobV1JobsJobIdGet({jobId:e.id});y({...v,[e.id]:s})}catch(e){}},children:"Details"}),("failed"===e.status||"dead"===e.status)&&(0,a.jsx)("button",{className:"btn",onClick:async()=>{try{await d.v1.retryJobV1JobsJobIdRetryPost({jobId:e.id}),p({kind:"success",message:"Job requeued"}),x()}catch(e){p({kind:"error",message:"Retry failed: ".concat(e.message||e)})}},children:"Retry"})]})]},e.id),N[e.id]&&(0,a.jsx)("tr",{className:"bg-gray-50",children:(0,a.jsx)("td",{className:"td",colSpan:6,children:(0,a.jsxs)("div",{className:"p-3",children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"Details"}),(0,a.jsx)("pre",{className:"text-sm bg-white p-3 rounded border overflow-auto",children:JSON.stringify(null!==(r=null!==(i=null===(l=v[e.id])||void 0===l?void 0:l.details)&&void 0!==i?i:e.details)&&void 0!==r?r:{},null,2)}),(0,a.jsx)("h4",{className:"font-semibold my-2",children:"Payload"}),(0,a.jsx)("pre",{className:"text-sm bg-white p-3 rounded border overflow-auto",children:JSON.stringify(null!==(u=null!==(o=null===(n=v[e.id])||void 0===n?void 0:n.payload)&&void 0!==o?o:e.payload)&&void 0!==u?u:{},null,2)})]})})},"".concat(e.id,"-details"))]},e.id)})})]})}),(0,a.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,a.jsx)("button",{className:"btn",disabled:t<=1,onClick:()=>r(t-1),children:"Prev"}),(0,a.jsxs)("span",{className:"text-gray-700",children:["Page ",t," / ",o.totalPages]}),(0,a.jsx)("button",{className:"btn",disabled:!o.hasNext,onClick:()=>r(t+1),children:"Next"})]})]})]})]})}}},function(e){e.O(0,[360,561,888,774,179],function(){return e(e.s=6538)}),_N_E=e.O()}]);